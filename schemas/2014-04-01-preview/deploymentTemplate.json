{
  "id": "https://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Template",
  "description": "An Azure deployment template",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON schema reference"
    },
    "metadata": {
      "type": "object",
      "description": "Additional unstructured metadata to include with the template deployment.",
      "additionalProperties": true
    },
    "contentVersion": {
      "type": "string",
      "pattern": "(^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$)",
      "description": "A 4 number format for the version number of this template file. For example, 1.0.0.0"
    },
    "variables": {
      "type": "object",
      "description": "Variable definitions"
    },
    "parameters": {
      "type": "object",
      "description": "Input parameter definitions",
      "additionalProperties": {
        "$ref": "#/definitions/parameter"
      }
    },
    "resources": {
      "description": "Collection of resources to be deployed",
      "oneOf":[
        {
          "$ref": "#/definitions/resourcesWithoutSymbolicNames"
        },
        {
          "$ref": "#/definitions/resourcesWithSymbolicNames"
        }
      ]
    },
    "outputs": {
      "type": "object",
      "description": "Output parameter definitions",
      "additionalProperties": {
        "$ref": "#/definitions/output"
      }
    }
  },
  "additionalProperties": false,
  "required": [
    "$schema",
    "contentVersion",
    "resources"
  ],
  "definitions": {
    "resourceBase": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the resource"
        },
        "dependsOn": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Collection of resources this resource depends on"
        },
        "location": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "enum": [
                "East Asia",
                "Southeast Asia",
                "Central US",
                "East US",
                "East US 2",
                "West US",
                "North Central US",
                "South Central US",
                "North Europe",
                "West Europe",
                "Japan West",
                "Japan East",
                "Brazil South",
                "Australia East",
                "Australia Southeast",
                "global"
              ]
            }
          ],
          "description": "Location to deploy resource to"
        },
        "tags": {
          "type": "object",
          "description": "Name-value pairs to add to the resource"
        },
        "scope": {
          "type": "string",
          "description": "Scope for the resource or deployment. Today, this works for two cases: 1) setting the scope for extension resources 2) deploying resources to the tenant scope in non-tenant scope deployments"
        }
      },
      "required": [
        "name",
        "type",
        "apiVersion"
      ]
    },
    "resourceGeneric": {
      "type": "object",
      "properties": {
        "type": {
          "enum": [
            "UnknownResource"
          ],
          "description": "Resource type"
        },
        "apiVersion": {
          "type": "string",
          "pattern": "(^((\\d\\d\\d\\d-\\d\\d-\\d\\d)|([0-9]+(\\.[0-9]+)?))(-[a-zA-Z][a-zA-Z0-9]*)?$)",
          "description": "API version of the resource type"
        }
      },
      "required": [
        "name",
        "type",
        "apiVersion"
      ]
    },
    "resourceBaseExternal": {
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/resourceBase"
        },
        {
          "properties": {
            "plan": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Name of the plan"
                },
                "promotionCode": {
                  "type": "string",
                  "description": "Plan promotion code"
                }
              },
              "additionalProperties": false,
              "required": [
                "name"
              ],
              "description": "3rd party plan"
            }
          },
          "required": [
            "plan"
          ]
        }
      ],
      "additionalProperties": false
    },
    "deployments": {
      "type": "object",
      "properties": {
        "type": {
          "enum": [
            "Microsoft.Resources/deployments"
          ]
        },
        "apiVersion": {
          "enum": [
            "2014-04-01-preview"
          ]
        },
        "name": {
          "type": "string",
          "description": "Name of the deployment"
        },
        "dependsOn": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Collection of resources this deployment depends on"
        },
        "properties": {
          "allOf": [
            {
              "type": "object",
              "properties": {
                "mode": {
                  "enum": [
                    "Incremental"
                  ],
                  "description": "Deployment mode"
                }
              },
              "required": [
                "mode"
              ]
            },
            {
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "templateLink": {
                      "$ref": "#/definitions/templateLink"
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "template": {
                      "type": "object"
                    }
                  }
                }
              ]
            },
            {
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "parametersLink": {
                      "$ref": "#/definitions/parametersLink"
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "parameters": {
                      "type": "object",
                      "additionalProperties": {
                        "$ref": "#/definitions/parameter"
                      }
                    }
                  }
                }
              ]
            }
          ]
        }
      },
      "required": [
        "type",
        "apiVersion",
        "name",
        "properties"
      ]
    },
    "templateLink": {
      "type": "object",
      "properties": {
        "uri": {
          "type": "string",
          "description": "URI referencing the deployment template"
        },
        "contentVersion": {
          "type": "string",
          "pattern": "(^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$)",
          "description": "If included it must match the contentVersion in the template"
        }
      },
      "required": [
        "uri"
      ],
      "description": "Template file reference in a deployment"
    },
    "parametersLink": {
      "type": "object",
      "properties": {
        "uri": {
          "type": "string",
          "description": "URI referencing the deployment template parameters"
        },
        "contentVersion": {
          "type": "string",
          "pattern": "(^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$)",
          "description": "If included it must match the contentVersion in the parameters file"
        }
      },
      "required": [
        "uri"
      ],
      "description": "Parameter file reference in a deployment"
    },
    "parameter": {
      "type": "object",
      "properties": {
        "type": {
          "enum": [
            "string",
            "securestring",
            "int",
            "bool",
            "object",
            "array"
          ]
        },
        "defaultValue": {
          "type": [
            "string",
            "boolean",
            "integer",
            "number",
            "object",
            "array",
            "null"
          ],
          "description": "Default value to be used if one is not provided"
        },
        "allowedValues": {
          "type": "array",
          "description": "Value can only be one of these values"
        },
        "metadata": {
          "type": "object",
          "description": "Metadata for the parameter"
        }
      },
      "required": [
        "type"
      ],
      "description": "Input parameter definitions"
    },
    "output": {
      "type": "object",
      "properties": {
        "type": {
          "enum": [
            "string",
            "securestring",
            "int",
            "bool",
            "object",
            "array"
          ]
        },
        "value": {
          "type": [
            "string",
            "boolean",
            "integer",
            "array",
            "object",
            "null"
          ],
          "description": "Value assigned for output"
        },
        "copy": {
          "$ref": "#/definitions/outputCopy",
          "description": "Output copy"
        }
      },
      "required": [
        "type"
      ],
      "description": "Set of output parameters"
    },
    "outputCopy": {
      "type": "object",
      "properties": {
        "count": {
          "oneOf": [
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            },
            {
              "type": "integer"
            }
          ],
          "description": "Count of the copy"
        },
        "input": {
          "anyOf": [
            {
              "type": [
                "string",
                "boolean",
                "integer",
                "array",
                "object",
                "null"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Input of the copy"
        }
      },
      "required": [
        "count",
        "input"
      ],
      "description": "Output copy"
    },
    "resource":{
      "description": "Collection of resource schemas",
      "oneOf": [
        {
          "$ref": "https://schema.management.azure.com/schemas/common/autogeneratedResources.json#resourceGroup"
        },
        {
          "$ref": "https://schema.management.azure.com/schemas/common/autogeneratedResources.json#unknown"
        }
      ]
    },
    "resourcesWithSymbolicNames":{
      "type": "object",
      "description": "Resources with symbolic names",
      "additionalProperties": {
        "$ref": "#/definitions/resource"
      }
    },
    "resourcesWithoutSymbolicNames":{
      "type": "array",
      "description": "Resources without symbolic names",
      "items": {
        "$ref": "#/definitions/resource"
      }
    }
  }
}