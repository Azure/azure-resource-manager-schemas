{
  "id": "https://schema.management.azure.com/schemas/2025-09-02-preview/Microsoft.ContainerService.NodeCustomization.json#",
  "title": "Microsoft.ContainerService",
  "description": "Microsoft ContainerService Resource Types",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "resourceDefinitions": {
    "nodeCustomizations": {
      "description": "Microsoft.ContainerService/nodeCustomizations",
      "properties": {
        "apiVersion": {
          "enum": [
            "2025-09-02-preview"
          ],
          "type": "string"
        },
        "location": {
          "description": "The geo-location where the resource lives",
          "type": "string"
        },
        "name": {
          "description": "The name of the Node Customization resource.",
          "oneOf": [
            {
              "maxLength": 63,
              "minLength": 1,
              "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
              "type": "string"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "properties": {
          "description": "The resource-specific properties for this resource.",
          "oneOf": [
            {
              "$ref": "#/definitions/NodeCustomizationProperties"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "tags": {
          "description": "Resource tags.",
          "oneOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "properties": {},
              "type": "object"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "type": {
          "enum": [
            "Microsoft.ContainerService/nodeCustomizations"
          ],
          "type": "string"
        }
      },
      "required": [
        "name",
        "properties",
        "apiVersion",
        "type"
      ],
      "type": "object"
    }
  },
  "definitions": {
    "NodeCustomizationProperties": {
      "description": "The properties of the Node Customization resource.",
      "properties": {
        "containerImages": {
          "description": "The list of container images to cache on nodes. See https://kubernetes.io/docs/concepts/containers/images/#image-names",
          "oneOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "customizationScripts": {
          "description": "The scripts to customize the node before or after image capture.",
          "oneOf": [
            {
              "items": {
                "$ref": "#/definitions/NodeCustomizationScript"
              },
              "type": "array"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "identityProfile": {
          "description": "The identity used to execute node customization tasks during image build time and provisioning time. \nIf not specified the default agentpool identity will be used.\nThis does not affect provisioned nodes.",
          "oneOf": [
            {
              "$ref": "#/definitions/UserAssignedIdentity"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        }
      },
      "type": "object"
    },
    "NodeCustomizationScript": {
      "description": "Node customization script",
      "properties": {
        "executionPoint": {
          "description": "The stage at which the script is executed.\nSpecifying `NodeImageBuildTime` will ensure changes are persisted into the node image.",
          "oneOf": [
            {
              "enum": [
                "NodeImageBuildTime",
                "NodeProvisionTime"
              ],
              "type": "string"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "name": {
          "description": "The name for the customization script. \nMust be unique within the node customization resource.\nCan only contain lowercase alphanumeric,'-' or '.' characters.",
          "oneOf": [
            {
              "maxLength": 263,
              "pattern": "^[a-z0-9]([a-z0-9\\.\\-]*[a-z0-9])?$",
              "type": "string"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "rebootAfter": {
          "description": "Whether the node should reboot after successful script execution.",
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        },
        "script": {
          "description": "The script content to be executed in plain text. Do not include secrets.",
          "type": "string"
        },
        "scriptType": {
          "description": "The runtime environment for the script (e.g. Bash).",
          "oneOf": [
            {
              "enum": [
                "Bash",
                "PowerShell"
              ],
              "type": "string"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ]
        }
      },
      "required": [
        "name",
        "executionPoint",
        "scriptType"
      ],
      "type": "object"
    },
    "UserAssignedIdentity": {
      "description": "User assigned identity properties",
      "properties": {},
      "type": "object"
    }
  }
}