{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "makKeyName": {
      "type": "string",
      "metadata": {
        "description": "The display name for the Azure resource."
      }
    },
    "numberOfComputers": {
      "type": "int",
      "metadata": {
        "description": "The number of computers on which you want to install Extended Security Updates with this key."
      }
    },
    "location": {
      "type": "string",
      "metadata": {
        "description": "The region where the Azure resource will be created."
      }
    },
    "agreementNumber": {
      "type": "string",
      "metadata": {
        "description": "The agreement number generated by the volume licensing contract management system, or MSLicense for Enterprise Agreement programs."
      }
    },
    "osType": {
      "type": "string",
      "allowedValues": ["WindowsServer2008", "WindowsServer2008R2"],
      "metadata": {
        "description": "Type of operating system for which the key is requested."
      }
    },
    "supportType": {
      "type": "string",
      "allowedValues": ["SupplementalServicing", "PremiumAssurance"],
      "metadata": {
        "description": "The support type"
      }
    },
    "isEligible": {
      "type": "bool",
      "metadata": {
        "description": "I confirm I have eligible on-premises Windows physical or virtual machines, and that this key will only be used in my organization."
      }
    },
    "tags": {
      "type": "object",
      "defaultValue": {},
      "metadata": {
        "description": "Use tags to categorize resources, which can be helpful especially for viewing consolidated billing data."
      }
    },
    "apiVersion": {
      "type": "string",
      "metadata": {
        "description": "ESU api version to use for the deployment."
      },
      "defaultValue": "2019-09-16-preview"
    }
  },
  "resources": [
    {
      "name": "[parameters('makKeyName')]",
      "apiVersion": "[parameters('apiVersion')]",
      "type": "Microsoft.WindowsESU/multipleActivationKeys",
      "location": "[parameters('location')]",
      "tags": "[parameters('tags')]",
      "properties": {
        "agreementNumber": "[parameters('agreementNumber')]",
        "installedServerNumber": "[parameters('numberOfComputers')]",
        "osType": "[parameters('osType')]",
        "supportType": "[parameters('supportType')]",
        "isEligible": "[parameters('isEligible')]"
      }
    }
  ]
}
